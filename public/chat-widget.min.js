class TiempoespacioChat{constructor(t={}){this.options={position:t.position||"bottom-right",primaryColor:t.primaryColor||"#00C853",...t},this.init()}init(){const t=document.createElement("style");t.textContent=`
.tiempoespacio-chat-widget{position:fixed;z-index:9999;${this.options.position.includes("bottom")?"bottom: 20px;":"top: 20px;"}${this.options.position.includes("right")?"right: 20px;":"left: 20px;"}}
.tiempoespacio-chat-button{width:80px;height:80px;border-radius:50%;background:${this.options.primaryColor};color:white;border:none;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.2);display:flex;align-items:center;justify-content:center;font-size:40px;transition:transform 0.3s,box-shadow 0.3s}
.tiempoespacio-chat-button:hover{transform:scale(1.1);box-shadow:0 6px 20px rgba(0,0,0,0.25)}
.tiempoespacio-chat-window{display:none;position:fixed;bottom:120px;right:20px;width:350px;height:500px;background:white;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,0.2);overflow:hidden;z-index:9999}
.tiempoespacio-chat-header{background:${this.options.primaryColor};color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;font-weight:bold}
.tiempoespacio-chat-close{background:none;border:none;color:white;cursor:pointer;font-size:24px;padding:5px}
.tiempoespacio-chat-messages{height:calc(100% - 140px);overflow-y:auto;padding:15px;margin-bottom:80px}
.tiempoespacio-chat-message{margin-bottom:10px;padding:10px;border-radius:10px;max-width:80%;color:#000000}
.tiempoespacio-chat-message a{color:#0066cc;text-decoration:underline;cursor:pointer}
.tiempoespacio-chat-message a:hover{color:#0052a3}
.tiempoespacio-chat-user{background:#e3f2fd;margin-left:auto;color:#000000}
.tiempoespacio-chat-bot{background:#f5f5f5;color:#000000}
.tiempoespacio-chat-input{padding:15px;border-top:1px solid #eee;display:flex;gap:10px;background:white;position:absolute;bottom:0;left:0;right:0;box-sizing:border-box}
.tiempoespacio-chat-input textarea{flex:1;padding:12px;border:1px solid #ddd;border-radius:10px;resize:none;height:50px;font-family:inherit;font-size:14px;line-height:1.4;box-sizing:border-box;color:#000000}
.tiempoespacio-chat-input button{padding:12px 20px;background:${this.options.primaryColor};color:white;border:none;border-radius:10px;cursor:pointer;height:50px;min-width:80px;font-weight:bold;font-size:14px;transition:background-color 0.3s}
.tiempoespacio-chat-input button:hover{opacity:0.9}
.tiempoespacio-chat-loading{display:none;text-align:center;padding:10px;color:#000000}
.tiempoespacio-chat-loading::after{content:'...';animation:dots 1.5s steps(4,end) infinite}
@keyframes dots{0%,20%{content:'.'} 40%{content:'..'} 60%{content:'...'} 80%,100%{content:''}}`,document.head.appendChild(t);const e=document.createElement("button");e.className="tiempoespacio-chat-widget tiempoespacio-chat-button",e.innerHTML="ðŸ“±",e.onclick=()=>this.toggleChat(),document.body.appendChild(e);const s=document.createElement("div");s.className="tiempoespacio-chat-window",s.innerHTML=`
<div class="tiempoespacio-chat-header">
<span>Chat Tiempoespacio</span>
<button class="tiempoespacio-chat-close">Ã—</button>
</div>
<div class="tiempoespacio-chat-messages"></div>
<div class="tiempoespacio-chat-loading">Pensando</div>
<div class="tiempoespacio-chat-input">
<textarea placeholder="Escribe tu mensaje..." rows="3"></textarea>
<button>Enviar</button>
</div>`,document.body.appendChild(s),this.chatWindow=s,this.messagesContainer=s.querySelector(".tiempoespacio-chat-messages"),this.input=s.querySelector("textarea"),this.sendButton=s.querySelector(".tiempoespacio-chat-input button"),this.closeButton=s.querySelector(".tiempoespacio-chat-close"),this.loading=s.querySelector(".tiempoespacio-chat-loading"),this.sendButton.onclick=()=>this.sendMessage(),this.closeButton.onclick=()=>this.toggleChat(),this.input.onkeypress=t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this.sendMessage())},this.addMessage("Â¡Wena! ðŸ‘‹ Soy Guille, el asistente de Tiempoespacio.cl. Â¿CÃ³mo te puedo ayudar hoy?","bot")}toggleChat(){this.chatWindow.style.display="none"===this.chatWindow.style.display?"block":"none"}addMessage(t,e){const s=document.createElement("div");s.className=`tiempoespacio-chat-message tiempoespacio-chat-${e}`;
// Si es un mensaje del bot, procesar los enlaces
if(e==="bot"){s.innerHTML=this.sanitizeHTML(t);}else{s.textContent=t;}
this.messagesContainer.appendChild(s),this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}sanitizeHTML(t){
    // Reemplazar [Hablar por WhatsApp] con el enlace
    t = t.replace(/\[Hablar por WhatsApp\]/g, '<a href="https://wa.me/+56947929330" target="_blank">Hablar por WhatsApp</a>');
    
    // Eliminar parÃ©ntesis y URL si quedaron
    t = t.replace(/\(https:\/\/wa\.me\/[^)]+\)/g, '');
    
    return t;
}async sendMessage(){const t=this.input.value.trim();if(!t)return;this.addMessage(t,"user"),this.input.value="",this.loading.style.display="block";try{const e=await fetch("https://tiempoespacio-chatbot.onrender.com/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,sessionId:"session-"+Math.random().toString(36).substr(2,9)})});const data=await e.json();if(data.error)throw new Error(data.error);this.addMessage(data.reply,"bot")}catch(t){console.error("Error:",t),this.addMessage("Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta de nuevo.","bot")}finally{this.loading.style.display="none"}}}window.TiempoespacioChat=TiempoespacioChat; 